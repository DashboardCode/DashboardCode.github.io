<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">

        <title>DashboardCode Multiselect Plugin for Bootstrap 5</title>
    </head>
    <body class="bg-light">
        <a href="https://github.com/DashboardCode/BsMultiSelect"><img width="149" height="149" 
            src="https://github.blog/wp-content/uploads/2008/12/forkme_right_white_ffffff.png?resize=149%2C149" 
             alt="Fork me on GitHub" data-recalc-dims="1"
             style="position: relative; float:right"></a>

        <div class="container">
            <div class="py-5 text-center">
                <h2>BsMultiselect</h2>
                <p class="lead">Multiselect Plugin for Bootstrap 5</p>
                <p class="code">dashboardcode.BsMultiSelect("#myElement");<br>$("#myElement").bsMultiSelect(); // jquery</p>
            </div>
            <br/>

            <div class="row g-2  align-items-center">
            <div class="col-auto">
                <label class="my-1 mr-2" for="bs-validation-id">BS4 "custom" validation. Put classes (do it on condition in your code) <code class="mx-2">is-valid</code> and <code class="mx-2">is-invalid</code> on original <code class="ml-2">select</code>:</label>
            </div>
            <div class="col-auto">
            <select id="bs-validation-id" class="form-select my-1 mr-2">
                <option value="DF" selected>(no validation)</option>
                <option value="VL">is-valid</option>
                <option value="INVL">is-invalid</option>
                <option value="NOQY">rule: invalid if Quenya</option>
            </select>
            </div>
            
            </div>
            <div class="row g-2 align-items-center">
                <div class="col-auto">
                    Using method: 
                </div>
                <div class="col-auto">
                    <select id="bs-feedback-method-id" class="form-select my-1 ml-2">
                        <option value="FD" selected>feedback</option>
                        <option value="TL">tooltip</option>
                    </select>
                </div>
            </div>
            <hr/><br/>
            <form action="https://postman-echo.com/post" method="post">
            <div class="row mb-3">
                <label class="col-form-label col-sm-2" for="languages-id">BsMultiselect:</label>
                <div class="col-sm-10">
                    <select name="States1" id="languages-id" class="form-select"  multiple="multiple">
                        <option value="AR" selected>Arabic</option>
                        <option value="EN">English</option>
                        <option value="CH">Chinese</option>
                        <option value="FR">French</option>
                        <option value="DE" >German</option>
                        <option value="ID">Indonesian</option>
                        <option value="MS">Malay</option>
                        <option value="LT" hidden>Lithuanian</option>
                        <option value="PT">Portuguese</option>
                        <option value="RU">Russian</option>
                        <option value="QY">Quenya</option>
                        <option value="ES">Spanish</option>
                    </select>
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">Invalid!</div>
                </div>
            </div>

            <div class="row mb-3 ">
                <label class="col-form-label col-sm-2" for="sample-id">Input sample:</label>
                <div class="col-sm-10"> 
                    <input  type="text" class="form-control" id="sample-id" value="">
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">Invalid!</div>
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-form-label col-sm-2" for="sample-complex-id">BsMultiselect:</label>
            
                <div class="col-sm-10 position-relative">
                    <div class="input-group dashboardcode-bsmultiselect ">
                        <ul class="form-control"></ul>
                        <select name="ComplexLanguages" id="complex-languages-id" 
                            class="form-select"  multiple="multiple" style="display: none;">
                                <option value="AR" selected>Arabic</option>
                                <option value="EN">English</option>
                                <option value="CH">Chinese</option>
                                <option value="FR">French</option>
                                <option value="DE">German</option>
                                <option value="ID">Indonesian</option>                            
                                <option value="MS">Malay</option>
                                <option value="LT" hidden>Lithuanian</option>                            
                                <option value="PT">Portuguese</option>
                                <option value="RU">Russian</option>
                                <option value="QY">Quenya</option>
                                <option value="ES">Spanish</option>
                        </select>

                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions</button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#"  onClick="$('#complex-languages-id').bsMultiSelect('DeselectAll')">Clear</a>
                            <a class="dropdown-item" href="#"  onClick="$('#complex-languages-id').bsMultiSelect('SelectAll')">Select All</a>
                        </div>
                    </div>
                    <div class="valid-feedback">Looks good!</div>
                    <div class="invalid-feedback">Invalid!</div>
                </div>
            </div>

                <div class="row mb-3">
                    <label class="col-form-label col-sm-2" for="sample-complex-id">Input sample:</label>
                    <div class="col-sm-10 position-relative "> 
                        <div class="input-group">
                            
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Actions</button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#"  onClick="$('#sample-complex-id').val('')">Clear</a>
                            </div>
                            <input type="text" class="form-control" id="sample-complex-id" aria-label="Amount (to the nearest dollar)">
                        </div>
                        <div class="valid-feedback">Looks good!</div>
                        <div class="invalid-feedback">Invalid!</div>
                    </div>
                </div>
            </form>
        </div>

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
        
        <script src="https://cdn.jsdelivr.net/npm/@dashboardcode/bsmultiselect@1.1.12/dist/js/BsMultiSelect.min.js"></script>
        <!--  <script src="https://rawgit.com/DashboardCode/BsMultiSelect/master/dist/js/BsMultiSelect.min.js"></script> -->
	    <!-- <script src="./../../BsMultiSelect/dist/js/BsMultiSelect.js"></script> -->
        

        <script>
            var isValidationEnabled = false;
            function isValid(selectElement){
                return $(selectElement).children("option[value='QY']:selected").length==0; 
            }
            function setValidity(selectElement){
                if (isValid(selectElement))
                    $(selectElement).removeClass('is-invalid').addClass('is-valid')
                else
                    $(selectElement).removeClass('is-valid').addClass('is-invalid')
            }
            $('#languages-id, #complex-languages-id').bsMultiSelect().change(
                function(){
                    console.log("change");
                    if (isValidationEnabled){
                        setValidity(this)
                        $(this).bsMultiSelect('UpdateValidity');
                    }
                }
            );

            $('#bs-validation-id').change(function() {
                var $all = $('#languages-id, #complex-languages-id, #sample-complex-id, #sample-id');
                if (this.value == 'DF') {
                    $all.removeClass('is-valid is-invalid')
                    isValidationEnabled=false;
                } else if (this.value == 'VL') {
                    $all.removeClass('is-invalid').addClass('is-valid')
                    isValidationEnabled=false;
                } else if (this.value == 'INVL') {
                    $all.removeClass('is-valid').addClass('is-invalid')
                    isValidationEnabled=false;
                } else if (this.value == 'NOQY') {
                    isValidationEnabled=true;
                    $all.removeClass('is-valid is-invalid')
                    $('#languages-id, #complex-languages-id').each( function(i,element){
                        setValidity(element)
                    })
                }
                
                $('#languages-id, #complex-languages-id').bsMultiSelect('UpdateValidity'); // push updates on original select to BsMutliSelect

                // note: next lines solves BS4 problem "feedback for inputs with prepend/append is not supported"
                var $inputGroup = $('#sample-complex-id').closest('.input-group');
                var $valid = $inputGroup.siblings('.valid-feedback, .valid-tooltip');
                var $invalid = $inputGroup.siblings('.invalid-feedback, .invalid-tooltip');
                if (this.value == 'DF' || this.value == 'NOQY' ) {
                    $valid.add($invalid).css('display','');
                } else if (this.value == 'VL') {
                    $valid.css('display','block');
                    $invalid.css('display','');
                } else if (this.value == 'INVL') {
                    $valid.css('display','');
                    $invalid.css('display','block');
                }
            });

            $('#bs-feedback-method-id').change(function() {
                if (this.value == 'TL') {
                    $('.valid-feedback').parent().addClass('position-relative')
                    $('.valid-feedback').removeClass('valid-feedback').addClass('valid-tooltip')
                    $('.invalid-feedback').removeClass('invalid-feedback').addClass('invalid-tooltip')
                } else {
                    $('.valid-feedback').parent().removeClass('position-relative')
                    $('.valid-tooltip').removeClass('valid-tooltip').addClass('valid-feedback')
                    $('.invalid-tooltip').removeClass('invalid-tooltip').addClass('invalid-feedback')
                }
            })
        </script>
    </body>
</html>
